import pandas as pd
import numpy as np
from sklearn.model_selection import train_test_split
from sklearn.linear_model import LinearRegression
from sklearn.metrics import mean_squared_error, r2_score
import matplotlib.pyplot as plt

# ==========================================
# 1. ‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Mock Data Generation)
# ==========================================
print("üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡πâ‡∏≥‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á 30 ‡∏ß‡∏±‡∏ô...")

# ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤ 30 ‡∏ß‡∏±‡∏ô (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á)
dates = pd.date_range(start='2024-01-01', periods=720, freq='H')

# ‡∏™‡∏£‡πâ‡∏≤‡∏á Pattern ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡πâ‡∏≥ (‡∏™‡∏°‡∏°‡∏ï‡∏¥‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏π‡∏õ‡∏Ñ‡∏•‡∏∑‡πà‡∏ô Sine Wave)
# TS2 (‡∏ï‡πâ‡∏ô‡∏ô‡πâ‡∏≥) ‡∏°‡∏≤‡∏Å‡πà‡∏≠‡∏ô, TS16 (‡∏Å‡∏•‡∏≤‡∏á‡∏ô‡πâ‡∏≥) ‡∏ï‡∏≤‡∏°‡∏°‡∏≤‡∏ó‡∏µ‡∏´‡∏•‡∏±‡∏á, TS5 (‡∏õ‡∏•‡∏≤‡∏¢‡∏ô‡πâ‡∏≥) ‡∏£‡∏∞‡∏ö‡∏≤‡∏¢‡∏≠‡∏≠‡∏Å
x = np.linspace(0, 50, 720)
ts2_data = 118 + 2 * np.sin(x) + np.random.normal(0, 0.1, 720) # ‡∏ï‡πâ‡∏ô‡∏ô‡πâ‡∏≥
ts16_data = 110 + 2 * np.sin(x - 0.5) + np.random.normal(0, 0.1, 720) # ‡∏Å‡∏•‡∏≤‡∏á‡∏ô‡πâ‡∏≥ (Lag ‡∏ï‡∏≤‡∏°‡∏ï‡πâ‡∏ô‡∏ô‡πâ‡∏≥)
ts5_data = 108 + 2 * np.sin(x - 0.8) + np.random.normal(0, 0.1, 720) # ‡∏õ‡∏•‡∏≤‡∏¢‡∏ô‡πâ‡∏≥

# ‡∏£‡∏ß‡∏°‡πÄ‡∏õ‡πá‡∏ô Dataframe ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á Excel)
df = pd.DataFrame({
    'timestamp': dates,
    'TS2': ts2_data,   # Feature 1
    'TS16': ts16_data, # Feature 2
    'TS5': ts5_data    # Feature 3
})

# ==========================================
# 2. ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏≠‡∏ô‡πÇ‡∏°‡πÄ‡∏î‡∏• (Preprocessing)
# ==========================================
PREDICT_HOURS = 6  # ‡πÄ‡∏£‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤ 6 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á

# ‡∏™‡∏£‡πâ‡∏≤‡∏á Column ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ (Target)
# ‡πÇ‡∏î‡∏¢‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤ TS16 ‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤ 6 ‡∏ä‡πà‡∏≠‡∏á (Shift)
# ‡πÅ‡∏õ‡∏•‡∏ß‡πà‡∏≤: ‡∏ì ‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÄ‡∏≠‡∏≤‡∏Ñ‡πà‡∏≤ TS16 ‡∏Ç‡∏≠‡∏á‡∏≠‡∏µ‡∏Å 6 ‡∏ä‡∏°. ‡∏Ç‡πâ‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡πÄ‡∏â‡∏•‡∏¢
df['Target_Next6H'] = df['TS16'].shift(-PREDICT_HOURS)

# ‡∏•‡∏ö‡πÅ‡∏ñ‡∏ß‡∏ó‡πâ‡∏≤‡∏¢‡πÜ ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏â‡∏•‡∏¢ (NaN) ‡∏ó‡∏¥‡πâ‡∏á
df.dropna(inplace=True)

# ‡∏Å‡∏≥‡∏´‡∏ô‡∏î X (‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏ï‡πâ‡∏ô: ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡πâ‡∏≥‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏ó‡∏±‡πâ‡∏á 3 ‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ)
X = df[['TS2', 'TS16', 'TS5']]

# ‡∏Å‡∏≥‡∏´‡∏ô‡∏î y (‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏ï‡∏≤‡∏°: ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡πâ‡∏≥ TS16 ‡πÉ‡∏ô‡∏≠‡∏µ‡∏Å 6 ‡∏ä‡∏°. ‡∏Ç‡πâ‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤)
y = df['Target_Next6H']

# ‡πÅ‡∏ö‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: 80% ‡πÄ‡∏≠‡∏≤‡πÑ‡∏ß‡πâ‡∏™‡∏≠‡∏ô(Train), 20% ‡πÄ‡∏≠‡∏≤‡πÑ‡∏ß‡πâ‡∏™‡∏≠‡∏ö(Test)
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, shuffle=False)

# ==========================================
# 3. ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏™‡∏≠‡∏ô‡πÇ‡∏°‡πÄ‡∏î‡∏• (Training)
# ==========================================
print("ü§ñ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏≠‡∏ô‡πÇ‡∏°‡πÄ‡∏î‡∏• AI...")
model = LinearRegression()
model.fit(X_train, y_train)

print("‚úÖ ‡∏™‡∏≠‡∏ô‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß!")
print(f"Intercept: {model.intercept_:.2f}")
print(f"Coefficients (‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç): TS2={model.coef_[0]:.2f}, TS16={model.coef_[1]:.2f}, TS5={model.coef_[2]:.2f}")

# ==========================================
# 4. ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥ (Evaluation)
# ==========================================
predictions = model.predict(X_test)
mse = mean_squared_error(y_test, predictions)
r2 = r2_score(y_test, predictions)

print(f"\nüìä ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö:")
print(f"Mean Squared Error (‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏•‡∏≤‡∏î‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô): {mse:.4f}")
print(f"R2 Score (‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥ 1.0 ‡∏Ñ‡∏∑‡∏≠‡πÄ‡∏õ‡πä‡∏∞‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î): {r2:.4f}")

# ==========================================
# 5. ‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á (Prediction)
# ==========================================
print("\nüîÆ ‡∏ó‡∏î‡∏•‡∏≠‡∏á‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢:")
# ‡∏™‡∏°‡∏°‡∏ï‡∏¥‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: ‡∏ô‡πâ‡∏≥‡∏ó‡πà‡∏ß‡∏°‡∏´‡∏ô‡∏±‡∏Å‡∏°‡∏≤‡∏Å
current_status = np.array([[120.50, 112.00, 113.00]]) # [TS2, TS16, TS5]
predicted_level = model.predict(current_status)

print(f"‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: TS2=120.50, TS16=112.00, TS5=113.00")
print(f"‡∏≠‡∏µ‡∏Å {PREDICT_HOURS} ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡∏Ç‡πâ‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤.. ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡πâ‡∏≥ TS16 ‡∏ô‡πà‡∏≤‡∏à‡∏∞‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà: {predicted_level[0]:.2f} ‡πÄ‡∏°‡∏ï‡∏£")

# ==========================================
# 6. ‡∏ß‡∏≤‡∏î‡∏Å‡∏£‡∏≤‡∏ü‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö (Visualization)
# ==========================================
plt.figure(figsize=(10, 5))
plt.plot(y_test.values, label='‡∏Ç‡∏≠‡∏á‡∏à‡∏£‡∏¥‡∏á (Actual)', color='blue', alpha=0.6)
plt.plot(predictions, label='AI ‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢ (Predicted)', color='red', linestyle='--')
plt.title(f'Comparison: Actual vs Predicted Water Level (Next {PREDICT_HOURS} Hours)')
plt.xlabel('Time Steps (Hours)')
plt.ylabel('Water Level (m)')
plt.legend()
plt.show()